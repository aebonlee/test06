# 알림 설정 최종 수정안

**작성일**: 2025-12-07
**목적**: 필요한 알림만 남기고 API 연결 설정 추가

---

## 📋 최종 My 설정 메뉴

```
⚙️ My 설정
├─ 거래 시작일 설정
├─ 누적손익 목표 설정
├─ 계좌 관리
├─ 🔌 API 연결 설정      ← 신규 추가
├─ 🔔 알림 설정
├─ 📊 데이터 관리
└─ 👤 프로필 관리
```

---

## 🔔 알림 설정 (최종안 - 4가지만)

### 제거된 알림 (필요 없음)

❌ **삭제**:
- ~~손익 목표 달성 알림~~ (필요 없음)
- ~~손절 발생 알림~~ (포지션 청산과 동일)
- ~~잔고 변동 알림~~ (필요 없음)
- ~~일일 목표 달성~~ (필요 없음)
- ~~월간 목표 달성~~ (필요 없음)
- ~~등급 승급~~ (필요 없음)
- ~~공지사항 등록~~ (직접 보면 됨)
- ~~시스템 점검~~ (필요 없음)

---

### 남은 알림 (4가지만)

#### 1) 포지션 청산 알림 ⭐⭐⭐⭐⭐

**언제**: 매매 포지션이 청산되었을 때 (손절 포함)

**알림 내용**:
```
💰 포지션 청산
챌린지 계좌에서 포지션이 청산되었습니다.

손익: +₩1,950,000
심볼: XAUUSD
진입: 2650 → 청산: 2671.5
LOT: 6.8

[상세 보기]
```

**손절인 경우**:
```
⚠️ 포지션 청산 (손절)
보험금 계좌에서 포지션이 청산되었습니다.

손익: -₩194,000
심볼: XAUUSD
진입: 2650 → 청산: 2671.5 (SL)
LOT: 0.9

[상세 보기]
```

**기본 설정**: ON

---

#### 2) 계좌 연동 상태 변경 알림 ⭐⭐⭐⭐⭐

**언제**:
- 계좌 연결이 해제되었을 때
- 계좌 재연결 성공했을 때

**알림 내용**:
```
🔴 계좌 연동 해제
펀딩 A 계좌의 연결이 해제되었습니다.

거래소: INFINOX
오류: API 키 만료

[재연결하기]
```

**기본 설정**: ON

---

#### 3) 데이터 동기화 오류 알림 ⭐⭐⭐⭐

**언제**:
- 5회 이상 연속 동기화 실패

**알림 내용**:
```
⚠️ 동기화 오류
챌린지 계좌 데이터 동기화에 실패했습니다.

오류 횟수: 5회
자동 재시도 중...

[계좌 설정 확인]
```

**기본 설정**: ON

---

#### 4) API 연결 오류 알림 ⭐⭐⭐⭐⭐

**언제**:
- API 연결 실패 시
- API 키 만료 시
- API 권한 오류 시

**알림 내용**:
```
🔴 API 연결 오류
챌린지 계좌의 API 연결에 실패했습니다.

거래소: Enso Markets
오류: 인증 실패 (401)
원인: API 키 또는 Secret이 잘못되었습니다.

[API 설정 확인]
```

**기본 설정**: ON

---

### 알림 방식 (웹 푸시만)

✅ **웹 푸시 알림** (유일)
- 즉시 전송
- 무료
- 클릭 시 해당 페이지 이동

❌ **제거**:
- ~~이메일 알림~~
- ~~SMS 알림~~

---

### 알림 설정 UI (최종)

```
┌─────────────────────────────────────┐
│ 🔔 알림 설정                   [×] │
├─────────────────────────────────────┤
│                                     │
│ ┌─ 거래 알림 ─────────────────┐   │
│ │                              │   │
│ │ ☑ 포지션 청산 시 알림         │   │
│ │   (손절 포함)                │   │
│ │                              │   │
│ └──────────────────────────────┘   │
│                                     │
│ ┌─ 계좌 알림 ─────────────────┐   │
│ │                              │   │
│ │ ☑ 계좌 연동 상태 변경 시      │   │
│ │ ☑ 데이터 동기화 오류 시       │   │
│ │ ☑ API 연결 오류 시           │   │
│ │                              │   │
│ └──────────────────────────────┘   │
│                                     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│ 알림 방식                            │
│ ☑ 웹 푸시 알림 (즉시)               │
│                                     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│ 📊 이번 달 알림 통계                 │
│ • 총 알림: 47건                     │
│ • 포지션 청산: 38건                  │
│ • 계좌 연동 변경: 3건                │
│ • 동기화 오류: 4건                   │
│ • API 연결 오류: 2건                 │
│                                     │
│        [취소]  [저장하기]           │
│                                     │
└─────────────────────────────────────┘
```

---

## 🔌 API 연결 설정 (신규 추가)

### 왜 필요한가?

**문제점**:
- 계좌 관리에서 API 키만 입력하고 끝
- API 연결 테스트 기능 없음
- API 권한 확인 불가
- API 키 만료일 모름

**해결책**:
- API 연결 테스트
- API 권한 확인
- API 키 만료일 알림
- API 사용량 확인

---

### API 연결 설정 항목

#### 1) API 키 관리

**기능**:
- API Key 보기/숨기기
- API Secret 재발급
- API 키 만료일 표시
- 연결 테스트

```
┌─────────────────────────────────────┐
│ 🔌 API 연결 설정               [×] │
├─────────────────────────────────────┤
│                                     │
│ ┌─ 챌린지 계좌 ──────────────────┐ │
│ │                                │ │
│ │ 거래소: Enso Markets           │ │
│ │ 상태: 🟢 연결됨                │ │
│ │ 마지막 동기화: 5초 전           │ │
│ │                                │ │
│ │ API Key:                       │ │
│ │ [enso_********************]   │ │
│ │                          [보기]│ │
│ │                                │ │
│ │ API Secret:                    │ │
│ │ [************************]    │ │
│ │                          [보기]│ │
│ │                                │ │
│ │ 만료일: 2025-12-31 (24일 남음) │ │
│ │                                │ │
│ │ 권한:                          │ │
│ │ ✅ 계좌 정보 조회              │ │
│ │ ✅ 거래 내역 조회              │ │
│ │ ✅ 포지션 조회                 │ │
│ │ ❌ 주문 실행 (사용 안 함)       │ │
│ │                                │ │
│ │ [연결 테스트] [API 재발급]     │ │
│ │ [연결 해제]                    │ │
│ │                                │ │
│ └────────────────────────────────┘ │
│                                     │
│ ┌─ 보험금 계좌 ──────────────────┐ │
│ │                                │ │
│ │ 거래소: Enso Markets           │ │
│ │ 상태: 🟢 연결됨                │ │
│ │ ...                            │ │
│ └────────────────────────────────┘ │
│                                     │
│ ┌─ 펀딩 A 계좌 ──────────────────┐ │
│ │                                │ │
│ │ 거래소: INFINOX                │ │
│ │ 상태: 🔴 연결 해제됨            │ │
│ │ 오류: API 키 만료              │ │
│ │                                │ │
│ │ [재연결하기]                   │ │
│ │                                │ │
│ └────────────────────────────────┘ │
│                                     │
│ ┌─ 펀딩 B 계좌 ──────────────────┐ │
│ │ ...                            │ │
│ └────────────────────────────────┘ │
│                                     │
│              [닫기]                │
│                                     │
└─────────────────────────────────────┘
```

---

#### 2) 연결 테스트

**기능**: API 연결 상태 즉시 확인

**테스트 항목**:
1. API 인증 (Key + Secret 유효성)
2. 계좌 정보 조회 가능 여부
3. 거래 내역 조회 가능 여부
4. 응답 속도 측정

**테스트 결과 화면**:
```
┌─────────────────────────────────────┐
│ 🔌 연결 테스트 결과                  │
├─────────────────────────────────────┤
│                                     │
│ 챌린지 계좌 (Enso Markets)          │
│                                     │
│ ✅ API 인증 성공                     │
│ ✅ 계좌 정보 조회 성공               │
│ ✅ 거래 내역 조회 성공               │
│ ✅ 포지션 조회 성공                  │
│                                     │
│ 응답 속도: 145ms (양호)              │
│                                     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│ 📊 테스트 통과: 4/4                 │
│ 상태: 정상 🟢                       │
│                                     │
│              [확인]                 │
│                                     │
└─────────────────────────────────────┘
```

**실패 시**:
```
┌─────────────────────────────────────┐
│ 🔌 연결 테스트 결과                  │
├─────────────────────────────────────┐
│                                     │
│ 펀딩 A 계좌 (INFINOX)               │
│                                     │
│ ❌ API 인증 실패                     │
│                                     │
│ 오류 코드: 401 Unauthorized          │
│ 오류 메시지: Invalid API credentials │
│                                     │
│ 원인:                                │
│ • API Key 또는 Secret이 잘못됨      │
│ • API 키가 만료됨                   │
│ • 권한이 부족함                      │
│                                     │
│ 해결 방법:                           │
│ 1. API 키를 다시 확인하세요          │
│ 2. 거래소에서 API 키를 재발급하세요  │
│ 3. API 권한을 확인하세요             │
│                                     │
│    [API 재설정] [고객센터 문의]     │
│                                     │
└─────────────────────────────────────┘
```

---

#### 3) API 권한 확인

**확인 항목**:
- ✅ 계좌 정보 조회 (필수)
- ✅ 거래 내역 조회 (필수)
- ✅ 포지션 조회 (필수)
- ❌ 주문 실행 (사용 안 함 - 보안상 위험)
- ❌ 주문 취소 (사용 안 함)
- ❌ 출금 (사용 안 함 - 절대 허용 금지)

**권한 설정 화면**:
```
┌─────────────────────────────────────┐
│ API 권한 확인                        │
├─────────────────────────────────────┤
│                                     │
│ 현재 API 키 권한:                    │
│                                     │
│ ✅ 계좌 정보 조회 (READ)             │
│ ✅ 거래 내역 조회 (READ)             │
│ ✅ 포지션 조회 (READ)                │
│ ❌ 주문 실행 (TRADE) - 미사용        │
│ ❌ 출금 (WITHDRAW) - 절대 금지       │
│                                     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│ ⚠️ 권장 권한 설정                    │
│                                     │
│ HDH Fintech는 "조회 전용" API만     │
│ 사용합니다.                          │
│                                     │
│ 거래소에서 API 키 생성 시            │
│ 아래 권한만 허용하세요:              │
│                                     │
│ ✅ Read (조회만)                     │
│ ❌ Trade (거래 실행) - 체크 해제     │
│ ❌ Withdraw (출금) - 체크 해제       │
│                                     │
│              [확인]                 │
│                                     │
└─────────────────────────────────────┘
```

---

#### 4) API 사용량 확인

**확인 항목**:
- 오늘 API 호출 횟수
- 월간 API 호출 횟수
- API 속도 제한 (Rate Limit) 상태

```
┌─────────────────────────────────────┐
│ API 사용량 통계                      │
├─────────────────────────────────────┤
│                                     │
│ 챌린지 계좌 (Enso Markets)          │
│                                     │
│ 오늘 사용량:                         │
│ 17,280건 / 100,000건 (17%)         │
│ ████░░░░░░░░░░░░░░░░                │
│                                     │
│ 이번 달 사용량:                      │
│ 450,000건 / 3,000,000건 (15%)      │
│ ███░░░░░░░░░░░░░░░░░                │
│                                     │
│ 속도 제한 (Rate Limit):              │
│ 분당: 120건 / 200건 가능            │
│ 초당: 2건 / 5건 가능                │
│                                     │
│ 마지막 호출: 5초 전                  │
│ 평균 응답 속도: 145ms                │
│                                     │
│              [닫기]                 │
│                                     │
└─────────────────────────────────────┘
```

---

#### 5) API 키 만료 알림

**기능**: 만료 7일 전부터 알림

**알림 시점**:
- 만료 7일 전
- 만료 3일 전
- 만료 1일 전
- 만료 당일

**알림 내용**:
```
⚠️ API 키 만료 예정
챌린지 계좌의 API 키가 곧 만료됩니다.

거래소: Enso Markets
만료일: 2025-12-31 (3일 남음)

만료되면 계좌 연동이 자동으로
해제됩니다.

[지금 재발급하기]
```

---

### API 연결 설정 전체 UI

```
┌─────────────────────────────────────┐
│ 🔌 API 연결 설정               [×] │
├─────────────────────────────────────┤
│                                     │
│ [탭] 연결 상태 | 사용량 | 보안      │
│       ▲                             │
│                                     │
│ ━━━ 연결 상태 탭 ━━━                │
│                                     │
│ 📊 전체 계좌 연결 상태               │
│ • 연결됨: 3개 🟢                    │
│ • 연결 해제: 1개 🔴                 │
│ • 마지막 동기화: 5초 전              │
│                                     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│ ┌─ 챌린지 계좌 ──────────────────┐ │
│ │ Enso Markets | 🟢 연결됨       │ │
│ │ API Key: enso_********         │ │
│ │ 만료일: 2025-12-31 (24일)      │ │
│ │ [상세] [테스트] [재발급]       │ │
│ └────────────────────────────────┘ │
│                                     │
│ ┌─ 보험금 계좌 ──────────────────┐ │
│ │ Enso Markets | 🟢 연결됨       │ │
│ │ ...                            │ │
│ └────────────────────────────────┘ │
│                                     │
│ ┌─ 펀딩 A 계좌 ──────────────────┐ │
│ │ INFINOX | 🔴 연결 해제됨        │ │
│ │ 오류: API 키 만료              │ │
│ │ [재연결하기]                   │ │
│ └────────────────────────────────┘ │
│                                     │
│ ┌─ 펀딩 B 계좌 ──────────────────┐ │
│ │ INFINOX | 🟢 연결됨            │ │
│ │ ...                            │ │
│ └────────────────────────────────┘ │
│                                     │
│              [닫기]                │
│                                     │
└─────────────────────────────────────┘
```

---

## ✅ 최종 정리

### My 설정 메뉴 (7개)

```
⚙️ My 설정
├─ 거래 시작일 설정
├─ 누적손익 목표 설정
├─ 계좌 관리
├─ 🔌 API 연결 설정        ← 신규
├─ 🔔 알림 설정            (4가지만)
├─ 📊 데이터 관리
└─ 👤 프로필 관리
```

---

### 알림 설정 (4가지만)

1. ✅ 포지션 청산 (손절 포함)
2. ✅ 계좌 연동 상태 변경
3. ✅ 데이터 동기화 오류
4. ✅ API 연결 오류

**알림 방식**: 웹 푸시만

---

### API 연결 설정 (5가지 기능)

1. ✅ API 키 관리 (보기/숨기기/재발급)
2. ✅ 연결 테스트 (4가지 항목 테스트)
3. ✅ API 권한 확인 (조회 전용 권장)
4. ✅ API 사용량 확인 (일/월 통계)
5. ✅ API 키 만료 알림 (7일 전부터)

---

**문서 버전**: 1.0
**최종 수정**: 2025-12-07
