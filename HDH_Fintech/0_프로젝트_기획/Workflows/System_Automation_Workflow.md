# System Automation Workflow

**문서 버전:** 1.0
**작성일:** 2025-12-09
**작성 근거:** HDH Fintech 실제 운영 요구사항 기반
**대상:** 자동화된 시스템 프로세스

---

## 📋 목차

1. [개요](#개요)
2. [일일 자동화 (Daily Automation)](#일일-자동화-daily-automation)
3. [월간 자동화 (Monthly Automation)](#월간-자동화-monthly-automation)
4. [이벤트 기반 자동화 (Event-driven Automation)](#이벤트-기반-자동화-event-driven-automation)
5. [알림 시스템 (Notification System)](#알림-시스템-notification-system)
6. [모니터링 및 로깅 (Monitoring & Logging)](#모니터링-및-로깅-monitoring--logging)

---

## 개요

### 목적
관리자의 수동 작업을 최소화하고, 시스템이 자동으로 반복 작업을 처리하도록 구성

### 기술 스택
- **Cron Jobs:** 스케줄링 작업
- **Webhooks:** 이벤트 기반 트리거
- **알림:** 이메일 자동 발송
- **모니터링:** 로그 기록 및 추적

### 자동화 철학
> **"관리자는 판단만 하고, 실행은 시스템이"**

- ✅ 반복적인 작업은 100% 자동화
- ✅ 예외 상황만 관리자에게 알림
- ✅ 모든 자동화 작업 로그 기록

---

## 일일 자동화 (Daily Automation)

### 1. 회원 활동 통계 집계 (매일 00:00)

#### 1-1. 개요
- **실행 시간:** 매일 00:00 (KST)
- **목적:** 전일 회원 활동 데이터 집계

#### 1-2. 자동화 흐름

```
00:00 Cron Job 실행
    ↓
전일(00:00 ~ 23:59) 활동 로그 집계
    ↓
├─ 신규 가입 회원 수 집계
├─ 교육 신청 건수 집계
├─ 교육 이수 건수 집계
├─ 추천인 코드 신청 건수 집계
├─ 추천인 코드 발급 건수 집계
├─ Sunny 챗봇 문의 건수 집계
└─ 고객센터 문의 건수 집계
    ↓
통계 테이블에 저장
    ↓
완료 로그 기록
```

#### 1-3. 데이터 저장

**테이블: daily_statistics**

| 컬럼 | 타입 | 설명 |
|------|------|------|
| date | DATE | 집계 날짜 |
| new_members | INT | 신규 가입 회원 수 |
| academy_applications | INT | 교육 신청 건수 |
| education_completed | INT | 교육 이수 건수 |
| referral_requests | INT | 추천인 코드 신청 건수 |
| referral_issued | INT | 추천인 코드 발급 건수 |
| sunny_inquiries | INT | Sunny 챗봇 문의 건수 |
| support_tickets | INT | 고객센터 문의 건수 |
| created_at | TIMESTAMP | 생성 시간 |

---

### 2. 미처리 항목 알림 (매일 09:00)

#### 2-1. 개요
- **실행 시간:** 매일 09:00 (KST)
- **목적:** 관리자에게 미처리 항목 알림 이메일 발송

#### 2-2. 자동화 흐름

```
09:00 Cron Job 실행
    ↓
미처리 항목 확인
    ↓
├─ 교육 신청 대기 건수 확인
├─ 추천인 코드 신청 대기 건수 확인
├─ Sunny 챗봇 답변 실패 건수 확인
└─ 고객센터 미답변 문의 건수 확인
    ↓
미처리 항목 있으면 → 관리자 이메일 발송
    ↓
완료 로그 기록
```

#### 2-3. 이메일 템플릿

```
제목: [HDH Fintech] 미처리 항목 알림 (2025-12-09)

안녕하세요, 관리자님.

오늘 처리가 필요한 항목을 안내드립니다:

📚 교육 신청 대기: 2건
🎯 추천인 코드 신청 대기: 4건
💬 Sunny 챗봇 답변 실패: 3건
📞 고객센터 미답변 문의: 5건

[Admin Dashboard 바로가기]

감사합니다.
HDH Fintech 시스템
```

---

### 3. 오래된 미답변 문의 알림 (매일 18:00)

#### 3-1. 개요
- **실행 시간:** 매일 18:00 (KST)
- **목적:** 24시간 이상 미답변 문의 알림

#### 3-2. 자동화 흐름

```
18:00 Cron Job 실행
    ↓
24시간 이상 미답변 문의 조회
    ↓
미답변 문의 있으면 → 관리자 긴급 알림
    ↓
완료 로그 기록
```

---

## 월간 자동화 (Monthly Automation)

### 1. 월간 통계 리포트 생성 (매월 1일 00:00)

#### 1-1. 개요
- **실행 시간:** 매월 1일 00:00 (KST)
- **목적:** 전월 통계 데이터를 집계하여 리포트 생성

#### 1-2. 자동화 흐름

```
매월 1일 00:00 Cron Job 실행
    ↓
전월 데이터 집계
    ↓
├─ 신규 가입 회원 수
├─ 누적 회원 수
├─ 교육 이수 인원
├─ 추천인 코드 발급 건수
├─ 문의 처리 건수
└─ Sunny 답변 성공률
    ↓
월간 리포트 테이블에 저장
    ↓
관리자 이메일로 리포트 발송
    ↓
완료 로그 기록
```

#### 1-3. 이메일 템플릿

```
제목: [HDH Fintech] 2025년 11월 월간 리포트

안녕하세요, 관리자님.

2025년 11월 월간 통계를 안내드립니다:

📊 회원 통계:
- 신규 가입: 45명
- 누적 회원: 501명
- 이탈 회원: 3명

📚 교육 통계:
- 교육 신청: 38건
- 교육 이수: 35건
- 이수율: 92.1%

🎯 추천인 코드:
- 신청: 35건
- 발급: 33건
- 발급률: 94.3%

💬 문의 통계:
- 총 문의: 127건
- Sunny 챗봇 처리: 98건 (77.2%)
- Sunny 답변 성공률: 85.7%
- 고객센터 처리: 29건
- 평균 답변 시간: 2.3시간

[상세 리포트 보기]

감사합니다.
HDH Fintech 시스템
```

---

### 2. 데이터베이스 백업 (매월 1일 02:00)

#### 2-1. 개요
- **실행 시간:** 매월 1일 02:00 (KST)
- **목적:** 전월 데이터 백업

#### 2-2. 자동화 흐름

```
매월 1일 02:00 Cron Job 실행
    ↓
데이터베이스 백업 실행
    ↓
백업 파일 생성 (예: backup_2025_11.sql)
    ↓
클라우드 스토리지에 저장
    ↓
관리자에게 백업 완료 알림
    ↓
완료 로그 기록
```

---

## 이벤트 기반 자동화 (Event-driven Automation)

### 1. 신규 회원 가입 시

#### 1-1. 트리거
- 이벤트: `users` 테이블에 새 레코드 INSERT

#### 1-2. 자동화 흐름

```
신규 회원 가입
    ↓
[자동 트리거 1] 환영 이메일 발송
    ↓
[자동 트리거 2] Admin Dashboard "최근 활동"에 추가
    ↓
[자동 트리거 3] 통계 카운터 +1
```

#### 1-3. 환영 이메일 템플릿

```
제목: [HDH Fintech] 환영합니다!

안녕하세요, {이름}님!

HDH Fintech에 가입해주셔서 감사합니다.

HDH 솔루션 운영을 위한 모든 지원이
준비되어 있습니다.

📌 다음 단계:
1. 솔루션 이해하기
2. 아카데미 교육 수강하기
3. 추천인 코드 신청하기
4. 매뉴얼 숙지하기

[Dashboard 바로가기]

감사합니다.
HDH Fintech 팀
```

---

### 2. 교육 신청 시

#### 2-1. 트리거
- 이벤트: `academy_applications` 테이블에 새 레코드 INSERT

#### 2-2. 자동화 흐름

```
교육 신청
    ↓
[자동 트리거 1] 신청 확인 이메일 발송 (사용자)
    ↓
[자동 트리거 2] 신청 알림 이메일 발송 (관리자)
    ↓
[자동 트리거 3] Admin Dashboard "최근 활동"에 추가
    ↓
[자동 트리거 4] "교육 신청 대기" 카운터 +1
```

#### 2-3. 사용자 이메일 템플릿

```
제목: [HDH Fintech] 아카데미 교육 신청이 접수되었습니다

안녕하세요, {이름}님!

아카데미 교육 신청 감사드립니다.

담당자가 확인 후 1-2일 이내에 연락 드리겠습니다.

📌 안내:
- 교육 일정은 개별 안내 예정
- 교육 완료 후 추천인 코드 신청 가능

감사합니다.
HDH Fintech 팀
```

#### 2-4. 관리자 이메일 템플릿

```
제목: [HDH Fintech Admin] 새 교육 신청 접수

새로운 교육 신청이 접수되었습니다.

신청자: {이름}
이메일: {이메일}
전화번호: {전화번호}
신청일: {신청일}

[Admin Dashboard에서 확인하기]
```

---

### 3. 교육 이수 처리 시

#### 3-1. 트리거
- 이벤트: 관리자가 "이수 처리" 버튼 클릭

#### 3-2. 자동화 흐름

```
관리자가 이수 처리
    ↓
[자동 트리거 1] 상태 업데이트: 교육 진행 중 → 이수 완료
    ↓
[자동 트리거 2] 이수 날짜 자동 입력
    ↓
[자동 트리거 3] 이수 완료 이메일 발송 (사용자)
    ↓
[자동 트리거 4] 추천인 코드 신청 자격 부여 (플래그 설정)
    ↓
[자동 트리거 5] 사용자 Dashboard에 "추천인 코드 신청 가능" 표시
```

#### 3-3. 사용자 이메일 템플릿

```
제목: [HDH Fintech] 아카데미 교육 이수 완료 축하드립니다!

안녕하세요, {이름}님!

아카데미 교육을 성공적으로 이수하셨습니다!
축하드립니다! 🎉

이제 다음 단계로 진행하실 수 있습니다:
1. 추천인 코드 신청하기
2. 매뉴얼 숙지하기
3. AI 프로그램 다운로드
4. My Settings 설정

[Dashboard 바로가기]

감사합니다.
HDH Fintech 팀
```

---

### 4. 추천인 코드 신청 시

#### 4-1. 트리거
- 이벤트: `referral_requests` 테이블에 새 레코드 INSERT

#### 4-2. 자동화 흐름

```
추천인 코드 신청
    ↓
[자동 트리거 1] 교육 이수 여부 자동 확인
    ↓
├─ 이수 완료 → 신청 확인 이메일 발송
│   ↓
│   관리자 알림 이메일 발송
│
└─ 이수 안 됨 → 자동 거부 + 거부 사유 이메일 발송
```

---

### 5. 추천인 코드 승인 시

#### 5-1. 트리거
- 이벤트: 관리자가 "승인" 버튼 클릭

#### 5-2. 자동화 흐름

```
관리자가 승인
    ↓
[자동 트리거 1] 추천인 코드 자동 생성
    (예: HDH2025ABC123)
    ↓
[자동 트리거 2] 상태 업데이트: 신청 대기 → 승인 완료
    ↓
[자동 트리거 3] 승인 완료 이메일 발송 (사용자)
    ↓
[자동 트리거 4] 사용자 Dashboard에 추천인 코드 표시
```

#### 5-3. 사용자 이메일 템플릿

```
제목: [HDH Fintech] 추천인 코드 발급 완료

안녕하세요, {이름}님!

추천인 코드가 발급되었습니다!

🎯 나의 추천인 코드: {추천인 코드}

📌 추천인 코드 용도:
- 회원 유입 경로 추적용
- 향후 통계 분석 자료로 활용

💡 참고:
추천인 코드는 순수 추적 목적이며,
별도 리워드는 없습니다.

[Dashboard 바로가기]

감사합니다.
HDH Fintech 팀
```

---

### 6. Sunny 챗봇 답변 실패 시

#### 6-1. 트리거
- 이벤트: AI가 답변을 생성하지 못함

#### 6-2. 자동화 흐름

```
Sunny 답변 실패
    ↓
[자동 트리거 1] 답변 실패 로그 기록
    ↓
[자동 트리거 2] Admin Dashboard "Sunny 챗봇 로그"에 표시
    ↓
[자동 트리거 3] 사용자에게 자동 응답
    "죄송합니다. 질문을 정확히 이해하지 못했어요.
     고객센터에서 곧 답변 드리겠습니다."
    ↓
[자동 트리거 4] 관리자 알림 (답변 실패 3건 이상 시)
```

---

### 7. 고객센터 문의 답변 시

#### 7-1. 트리거
- 이벤트: 관리자가 "답변 전송" 버튼 클릭

#### 7-2. 자동화 흐름

```
관리자가 답변 전송
    ↓
[자동 트리거 1] 상태 업데이트: 미답변 → 답변 완료
    ↓
[자동 트리거 2] 답변 이메일 발송 (사용자)
    ↓
[자동 트리거 3] 사용자 Dashboard "내 문의 내역"에 답변 표시
```

#### 7-3. 사용자 이메일 템플릿

```
제목: [HDH Fintech] 문의하신 내용에 대한 답변입니다

안녕하세요, {이름}님!

문의하신 내용에 대해 답변드립니다.

문의 제목: {문의 제목}
문의 번호: {문의 번호}

답변:
{답변 내용}

추가 문의사항이 있으시면 언제든 연락주세요.

[내 문의 내역 보기]

감사합니다.
HDH Fintech 팀
```

---

## 알림 시스템 (Notification System)

### 1. 이메일 알림 트리거 목록

| 이벤트 | 수신자 | 발송 시점 |
|--------|--------|----------|
| 신규 회원 가입 | 사용자 | 즉시 |
| 교육 신청 | 사용자 | 즉시 |
| 교육 신청 | 관리자 | 즉시 |
| 교육 이수 완료 | 사용자 | 즉시 |
| 추천인 코드 신청 | 사용자 | 즉시 |
| 추천인 코드 신청 | 관리자 | 즉시 |
| 추천인 코드 발급 | 사용자 | 즉시 |
| 고객센터 문의 답변 | 사용자 | 즉시 |
| 미처리 항목 알림 | 관리자 | 매일 09:00 |
| 오래된 미답변 문의 | 관리자 | 매일 18:00 |
| 월간 리포트 | 관리자 | 매월 1일 00:00 |

---

### 2. Dashboard 실시간 알림

**알림 표시 위치:**
- Admin Dashboard 우측 상단 알림 아이콘

**알림 유형:**
- 🔴 긴급 문의 접수
- 🟡 교육 신청 접수
- 🟡 추천인 코드 신청 접수
- 🟢 신규 회원 가입

---

## 모니터링 및 로깅 (Monitoring & Logging)

### 1. 자동화 작업 로그

**로그 테이블: automation_logs**

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | INT | 로그 ID |
| job_name | VARCHAR | 작업 이름 |
| execution_time | TIMESTAMP | 실행 시간 |
| status | VARCHAR | 상태 (success/failed) |
| error_message | TEXT | 오류 메시지 (실패 시) |
| duration_ms | INT | 실행 소요 시간 (밀리초) |

---

### 2. 이메일 발송 로그

**로그 테이블: email_logs**

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | INT | 로그 ID |
| recipient_email | VARCHAR | 수신자 이메일 |
| subject | VARCHAR | 이메일 제목 |
| template_name | VARCHAR | 템플릿 이름 |
| sent_at | TIMESTAMP | 발송 시간 |
| status | VARCHAR | 상태 (sent/failed) |
| error_message | TEXT | 오류 메시지 (실패 시) |

---

### 3. 시스템 모니터링

**모니터링 항목:**
- Cron Job 실행 상태
- 이메일 발송 성공률
- API 응답 시간
- 데이터베이스 연결 상태
- 서버 CPU/메모리 사용률

**알림 기준:**
- Cron Job 실패 → 즉시 관리자 알림
- 이메일 발송 실패율 > 10% → 관리자 알림
- API 응답 시간 > 3초 → 관리자 알림

---

**문서 작성:** Claude Code
**승인:** 2025-12-09
